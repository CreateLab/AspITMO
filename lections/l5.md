```markdown
# –õ–µ–∫—Ü–∏—è 4: –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏ real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –≤ ASP.NET Core

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 60 –º–∏–Ω—É—Ç  
**–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ .NET —Å –±–∞–∑–æ–≤—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ ASP.NET Core

---

## –¶–µ–ª–∏ –ª–µ–∫—Ü–∏–∏

–ö –∫–æ–Ω—Ü—É –ª–µ–∫—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ:
- –ü–æ–Ω–∏–º–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
- –ü—Ä–∏–º–µ–Ω—è—Ç—å streaming –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É WebSockets –∏ SignalR
- –°–æ–∑–¥–∞–≤–∞—Ç—å real-time –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SignalR Hubs
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—ã –∏ broadcasting –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

---

## –ß–∞—Å—Ç—å 1: –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ (30 –º–∏–Ω—É—Ç)

### 1.1 –û—Å–Ω–æ–≤—ã –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ HTTP (7 –º–∏–Ω—É—Ç)

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–µ–±-—Ñ–æ—Ä–º—É, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

1. **–ë—Ä–∞—É–∑–µ—Ä** —Å–æ–∑–¥–∞–µ—Ç HTTP POST –∑–∞–ø—Ä–æ—Å —Å `Content-Type: multipart/form-data`
2. **Multipart encoding** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
3. **–°–µ—Ä–≤–µ—Ä** –ø–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ multipart/form-data –∑–∞–ø—Ä–æ—Å–∞:**

```
POST /upload HTTP/1.1
Content-Type: multipart/form-data; boundary=----Boundary123

------Boundary123
Content-Disposition: form-data; name="title"

–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
------Boundary123
Content-Disposition: form-data; name="file"; filename="document.pdf"
Content-Type: application/pdf

[–±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞]
------Boundary123--
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- **Boundary** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞-—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ –∑–∞–ø—Ä–æ—Å–∞
- **Content-Disposition** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è –ø–æ–ª—è –∏ –∏–º—è —Ñ–∞–π–ª–∞
- **Content-Type** ‚Äî MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `image/jpeg`, `application/pdf`)

#### IFormFile: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

ASP.NET Core –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IFormFile` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏:

```csharp
public interface IFormFile
{
    string FileName { get; }           // –ò–º—è —Ñ–∞–π–ª–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
    string ContentType { get; }        // MIME-—Ç–∏–ø
    long Length { get; }               // –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    
    Stream OpenReadStream();           // –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ç–æ–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è
    Task CopyToAsync(Stream target);   // –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
}
```

**–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:**

```csharp
[HttpPost("upload")]
public async Task<IActionResult> Upload(IFormFile file)
{
    if (file == null || file.Length == 0)
        return BadRequest("–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω");
    
    // –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    var uploadsFolder = Path.Combine("wwwroot", "uploads");
    var fileName = $"{Guid.NewGuid()}{Path.GetExtension(file.FileName)}";
    var filePath = Path.Combine(uploadsFolder, fileName);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
    using (var stream = new FileStream(filePath, FileMode.Create))
    {
        await file.CopyToAsync(stream);
    }
    
    return Ok(new { fileName, size = file.Length });
}
```

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤:**

```csharp
[HttpPost("upload-multiple")]
public async Task<IActionResult> UploadMultiple(List<IFormFile> files)
{
    var uploadedFiles = new List<string>();
    
    foreach (var file in files)
    {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
        var fileName = await SaveFileAsync(file);
        uploadedFiles.Add(fileName);
    }
    
    return Ok(uploadedFiles);
}
```

### 1.2 –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (5 –º–∏–Ω—É—Ç)

#### FileResult –∏ –µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ

ASP.NET Core –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤:

**1. PhysicalFileResult** ‚Äî —Ñ–∞–π–ª –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:

```csharp
[HttpGet("download/{fileName}")]
public IActionResult DownloadFile(string fileName)
{
    var path = Path.Combine("wwwroot", "uploads", fileName);
    
    if (!System.IO.File.Exists(path))
        return NotFound();
    
    // –ú–µ—Ç–æ–¥ File() —Å–æ–∑–¥–∞–µ—Ç PhysicalFileResult
    return PhysicalFile(
        path,
        "application/octet-stream",  // MIME-—Ç–∏–ø
        fileName                      // –ò–º—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    );
}
```

**2. FileContentResult** ‚Äî —Ñ–∞–π–ª –∏–∑ –º–∞—Å—Å–∏–≤–∞ –±–∞–π—Ç–æ–≤:

```csharp
[HttpGet("generate-text")]
public IActionResult GenerateText()
{
    var text = "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!";
    var bytes = Encoding.UTF8.GetBytes(text);
    
    return File(bytes, "text/plain", "hello.txt");
}
```

**3. FileStreamResult** ‚Äî —Ñ–∞–π–ª –∏–∑ –ø–æ—Ç–æ–∫–∞:

```csharp
[HttpGet("download-from-db/{id}")]
public async Task<IActionResult> DownloadFromDatabase(int id)
{
    var fileData = await _repository.GetFileAsync(id);
    var stream = new MemoryStream(fileData.Content);
    
    return File(stream, fileData.ContentType, fileData.FileName);
}
```

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ –ø–æ–º–Ω–∏—Ç–µ –æ `using` –∏–ª–∏ –ø–æ–∑–≤–æ–ª—å—Ç–µ ASP.NET Core –∑–∞–∫—Ä—ã—Ç—å –ø–æ—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏.

#### Content-Disposition: inline vs attachment

```csharp
// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (Save As dialog)
Response.Headers["Content-Disposition"] = 
    $"attachment; filename=\"{fileName}\"";

// –û—Ç–∫—Ä—ã—Ç–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–¥–ª—è PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
Response.Headers["Content-Disposition"] = 
    $"inline; filename=\"{fileName}\"";
```

### 1.3 Streaming –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (8 –º–∏–Ω—É—Ç)

#### –ü—Ä–æ–±–ª–µ–º–∞ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ASP.NET Core –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å (–∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª), –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã:

- **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏**: —Ñ–∞–π–ª 100 MB = 100 MB –≤ –ø–∞–º—è—Ç–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ = 1 GB –ø–∞–º—è—Ç–∏
- **–¢–∞–π–º–∞—É—Ç—ã**: –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –Ω–µ —É—Å–ø–µ—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è

**–†–µ—à–µ–Ω–∏–µ: Streaming**

Streaming –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª –ø–æ —á–∞—Å—Ç—è–º (chunks), –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è –µ–≥–æ —Ü–µ–ª–∏–∫–æ–º:

```
–û–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:
Client ‚Üí [–≤–µ—Å—å —Ñ–∞–π–ª] ‚Üí Memory/TempFile ‚Üí Controller

Streaming:
Client ‚Üí [chunk 1] ‚Üí Process ‚Üí Storage
      ‚Üí [chunk 2] ‚Üí Process ‚Üí Storage
      ‚Üí [chunk 3] ‚Üí Process ‚Üí Storage
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è streaming —Å MultipartReader

```csharp
using Microsoft.AspNetCore.WebUtilities;

[HttpPost("stream-upload")]
[DisableFormValueModelBinding]  // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é!
[RequestSizeLimit(500_000_000)] // –õ–∏–º–∏—Ç 500 MB
public async Task<IActionResult> StreamLargeFile()
{
    // –ü–æ–ª—É—á–∞–µ–º boundary –∏–∑ Content-Type
    var boundary = GetBoundary(Request.ContentType);
    var reader = new MultipartReader(boundary, Request.Body);
    
    MultipartSection section;
    while ((section = await reader.ReadNextSectionAsync()) != null)
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–µ–∫—Ü–∏—è —Ñ–∞–π–ª–æ–º
        var hasContentDisposition = ContentDispositionHeaderValue.TryParse(
            section.ContentDisposition, 
            out var contentDisposition
        );
        
        if (hasContentDisposition && contentDisposition.IsFileDisposition())
        {
            var fileName = contentDisposition.FileName.Value;
            var targetPath = Path.Combine("uploads", fileName);
            
            // Streaming –Ω–∞–ø—Ä—è–º—É—é –≤ —Ñ–∞–π–ª
            using (var targetStream = System.IO.File.Create(targetPath))
            {
                await section.Body.CopyToAsync(targetStream);
            }
        }
    }
    
    return Ok("–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω");
}

private string GetBoundary(string contentType)
{
    var elements = contentType.Split(' ');
    var element = elements.First(e => e.StartsWith("boundary="));
    return element.Substring("boundary=".Length).Trim('"');
}
```

**–ê—Ç—Ä–∏–±—É—Ç DisableFormValueModelBinding:**

–≠—Ç–æ—Ç –∞—Ç—Ä–∏–±—É—Ç –æ—Ç–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –º–æ–¥–µ–ª—å —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–ª—è —Ñ–æ—Ä–º, –ø–æ–∑–≤–æ–ª—è—è –Ω–∞–º –ø–æ–ª—É—á–∏—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `Request.Body`:

```csharp
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]
public class DisableFormValueModelBindingAttribute : Attribute, IResourceFilter
{
    public void OnResourceExecuting(ResourceExecutingContext context)
    {
        var factories = context.ValueProviderFactories;
        factories.RemoveType<FormValueProviderFactory>();
        factories.RemoveType<FormFileValueProviderFactory>();
        factories.RemoveType<JQueryFormValueProviderFactory>();
    }
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å streaming:**
- ‚úÖ –§–∞–π–ª—ã –±–æ–ª—å—à–µ 5-10 MB
- ‚úÖ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–º–Ω–æ–≥–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- ‚ùå –ú–∞–ª—ã–µ —Ñ–∞–π–ª—ã (overhead –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω)
- ‚ùå –ù—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### 1.4 –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ (10 –º–∏–Ω—É—Ç)

#### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞

**–£—Ä–æ–≤–µ–Ω—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞**

```csharp
// Program.cs
builder.Services.Configure<FormOptions>(options =>
{
    options.MultipartBodyLengthLimit = 52428800;  // 50 MB
    options.MemoryBufferThreshold = 65536;        // 64 KB
});

// –î–ª—è Kestrel
builder.WebHost.ConfigureKestrel(options =>
{
    options.Limits.MaxRequestBodySize = 52428800; // 50 MB
});
```

**–£—Ä–æ–≤–µ–Ω—å 2: –ê—Ç—Ä–∏–±—É—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–∏**

```csharp
[RequestSizeLimit(10_485_760)] // 10 MB
[HttpPost("upload")]
public async Task<IActionResult> Upload(IFormFile file)
{
    // ...
}
```

**–£—Ä–æ–≤–µ–Ω—å 3: –ö–∞—Å—Ç–æ–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**

```csharp
public class MaxFileSizeAttribute : ValidationAttribute
{
    private readonly int _maxFileSize;
    
    public MaxFileSizeAttribute(int maxFileSize)
    {
        _maxFileSize = maxFileSize;
        ErrorMessage = $"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {maxFileSize / 1048576} MB";
    }
    
    protected override ValidationResult IsValid(
        object value, 
        ValidationContext validationContext)
    {
        if (value is IFormFile file)
        {
            if (file.Length > _maxFileSize)
            {
                return new ValidationResult(ErrorMessage);
            }
        }
        
        return ValidationResult.Success;
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–æ–¥–µ–ª–∏
public class FileUploadModel
{
    [Required]
    [MaxFileSize(10 * 1024 * 1024)] // 10 MB
    public IFormFile File { get; set; }
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞

**–ü—Ä–æ–±–ª–µ–º–∞: MIME-type –Ω–µ–Ω–∞–¥–µ–∂–µ–Ω**

–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª—é–±–æ–π `Content-Type`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ MIME-—Ç–∏–ø–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞:

```csharp
// ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û
if (file.ContentType == "image/jpeg")
{
    // –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å .exe —Å Content-Type: image/jpeg
}
```

**–†–µ—à–µ–Ω–∏–µ: File Signature (Magic Numbers)**

–ö–∞–∂–¥—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é "–ø–æ–¥–ø–∏—Å—å" –≤ –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç–∞—Ö:

```csharp
public class FileSignatureValidator
{
    // –°–∏–≥–Ω–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
    private static readonly Dictionary<string, List<byte[]>> _fileSignatures = new()
    {
        {
            ".jpg", new List<byte[]>
            {
                new byte[] { 0xFF, 0xD8, 0xFF, 0xE0 },  // JFIF
                new byte[] { 0xFF, 0xD8, 0xFF, 0xE1 },  // EXIF
            }
        },
        {
            ".png", new List<byte[]>
            {
                new byte[] { 0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A }
            }
        },
        {
            ".pdf", new List<byte[]>
            {
                new byte[] { 0x25, 0x50, 0x44, 0x46 }  // %PDF
            }
        },
        {
            ".zip", new List<byte[]>
            {
                new byte[] { 0x50, 0x4B, 0x03, 0x04 }  // PK..
            }
        }
    };
    
    public static async Task<bool> IsValidFileType(
        IFormFile file, 
        string[] allowedExtensions)
    {
        var extension = Path.GetExtension(file.FileName).ToLowerInvariant();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        if (!allowedExtensions.Contains(extension))
            return false;
        
        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        if (!_fileSignatures.ContainsKey(extension))
            return true;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
        using var reader = new BinaryReader(file.OpenReadStream());
        var signatures = _fileSignatures[extension];
        var headerBytes = reader.ReadBytes(
            signatures.Max(m => m.Length)
        );
        
        return signatures.Any(signature =>
            headerBytes.Take(signature.Length).SequenceEqual(signature)
        );
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```csharp
[HttpPost("upload")]
public async Task<IActionResult> Upload(IFormFile file)
{
    var allowedExtensions = new[] { ".jpg", ".png", ".pdf" };
    
    if (!await FileSignatureValidator.IsValidFileType(file, allowedExtensions))
    {
        return BadRequest("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞");
    }
    
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...
}
```

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

**1. Path Traversal Attack**

```csharp
// ‚ùå –£–Ø–ó–í–ò–ú–û
var path = Path.Combine("uploads", file.FileName);
// –ï—Å–ª–∏ file.FileName = "../../etc/passwd", —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞!

// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
var safeFileName = Path.GetRandomFileName();
var extension = Path.GetExtension(file.FileName).ToLowerInvariant();
var path = Path.Combine("uploads", $"{safeFileName}{extension}");

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
var fullPath = Path.GetFullPath(path);
if (!fullPath.StartsWith(Path.GetFullPath("uploads")))
    throw new InvalidOperationException("Path traversal detected!");
```

**2. –ó–∞–ø—Ä–µ—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤**

```csharp
private static readonly HashSet<string> DangerousExtensions = new()
{
    ".exe", ".dll", ".bat", ".cmd", ".ps1", ".sh",
    ".asp", ".aspx", ".php", ".jsp"
};

if (DangerousExtensions.Contains(extension))
{
    return BadRequest("–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–∞");
}
```

**3. –ò–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤**

```csharp
// –•—Ä–∞–Ω–∏—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –í–ù–ï wwwroot
// ‚úÖ /var/uploads (–≤–Ω–µ webroot)
// ‚ùå /wwwroot/uploads (–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ URL)

// –û—Ç–¥–∞–≤–∞–π—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
[HttpGet("files/{id}")]
[Authorize]
public async Task<IActionResult> Download(int id)
{
    var file = await _repository.GetFileAsync(id);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
    if (file.UserId != GetCurrentUserId())
        return Forbid();
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    Response.Headers["X-Content-Type-Options"] = "nosniff";
    Response.Headers["Content-Security-Policy"] = "default-src 'none'";
    
    return File(file.Content, file.ContentType, file.FileName);
}
```

---

## –ß–∞—Å—Ç—å 2: Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

### 2.1 –í–≤–µ–¥–µ–Ω–∏–µ –≤ real-time —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (5 –º–∏–Ω—É—Ç)

#### –ß—Ç–æ —Ç–∞–∫–æ–µ real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è ‚Äî —ç—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫, —Ç–∏–ø–∏—á–Ω—ã—Ö –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- üí¨ –ß–∞—Ç—ã –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã
- üîî Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- üìä Live –¥–∞—à–±–æ—Ä–¥—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- üéÆ –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–≥—Ä—ã
- üìù –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- üìà –ë–∏—Ä–∂–µ–≤—ã–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

#### –≠–≤–æ–ª—é—Ü–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤

**1. Polling (–æ–ø—Ä–æ—Å)**

```javascript
// –ö–ª–∏–µ–Ω—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?"
setInterval(async () => {
    const response = await fetch('/api/messages/new');
    const newMessages = await response.json();
    // –û–±—Ä–∞–±–æ—Ç–∫–∞...
}, 5000); // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 5 —Å–µ–∫—É–Ω–¥
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚ùå –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç "–Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
- ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**2. Long Polling (–¥–ª–∏–Ω–Ω—ã–π –æ–ø—Ä–æ—Å)**

```javascript
async function longPoll() {
    const response = await fetch('/api/messages/wait-for-new');
    const newMessages = await response.json();
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    
    // –°—Ä–∞–∑—É –∂–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ
    longPoll();
}
```

–°–µ—Ä–≤–µ—Ä –¥–µ—Ä–∂–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```csharp
[HttpGet("wait-for-new")]
public async Task<IActionResult> WaitForNewMessages()
{
    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–æ 30 —Å–µ–∫)
    var messages = await _messageQueue.WaitForMessagesAsync(
        timeout: TimeSpan.FromSeconds(30)
    );
    
    return Ok(messages);
}
```

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—É—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ = –Ω–æ–≤–æ–µ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (overhead)
- ‚ùå –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**3. Server-Sent Events (SSE)**

–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø–æ—Ç–æ–∫ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É:

```csharp
[HttpGet("notifications")]
public async Task StreamNotifications()
{
    Response.Headers["Content-Type"] = "text/event-stream";
    
    await foreach (var notification in GetNotificationsStream())
    {
        await Response.WriteAsync($"data: {notification}\n\n");
        await Response.Body.FlushAsync();
    }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –¢–æ–ª—å–∫–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**4. WebSockets ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**

–ü–æ–ª–Ω–æ–¥—É–ø–ª–µ–∫—Å–Ω–∞—è —Å–≤—è–∑—å –ø–æ –æ–¥–Ω–æ–º—É TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é:

```
Client ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí Server
       Bidirectional
       Full-duplex
       Single connection
```

### 2.2 WebSockets: –æ—Å–Ω–æ–≤—ã –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (8 –º–∏–Ω—É—Ç)

#### –ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket

WebSocket ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –ø–æ –æ–¥–Ω–æ–º—É TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é.

**Handshake (—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ):**

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å —Å upgrade:

```http
GET /ws HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
```

2. –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ–º:

```http
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
```

3. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ "–ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è" –≤ WebSocket, –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ–±–º–µ–Ω —Ñ—Ä–µ–π–º–∞–º–∏.

#### WebSocket –≤ ASP.NET Core

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware:**

```csharp
// Program.cs
var app = builder.Build();

// 1. –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É WebSockets
app.UseWebSockets(new WebSocketOptions
{
    KeepAliveInterval = TimeSpan.FromMinutes(2),  // Ping –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
    ReceiveBufferSize = 4 * 1024                   // –ë—É—Ñ–µ—Ä 4 KB
});

// 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º WebSocket –∑–∞–ø—Ä–æ—Å—ã
app.Map("/ws", async context =>
{
    if (context.WebSockets.IsWebSocketRequest)
    {
        using var webSocket = await context.WebSockets.AcceptWebSocketAsync();
        await HandleWebSocketAsync(webSocket);
    }
    else
    {
        context.Response.StatusCode = 400;
    }
});

app.Run();
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**

```csharp
private static async Task HandleWebSocketAsync(WebSocket webSocket)
{
    var buffer = new byte[1024 * 4]; // 4 KB –±—É—Ñ–µ—Ä
    
    // –¶–∏–∫–ª –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    while (webSocket.State == WebSocketState.Open)
    {
        var result = await webSocket.ReceiveAsync(
            new ArraySegment<byte>(buffer),
            CancellationToken.None
        );
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        switch (result.MessageType)
        {
            case WebSocketMessageType.Text:
                var message = Encoding.UTF8.GetString(buffer, 0, result.Count);
                Console.WriteLine($"–ü–æ–ª—É—á–µ–Ω–æ: {message}");
                
                // Echo: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                await webSocket.SendAsync(
                    new ArraySegment<byte>(buffer, 0, result.Count),
                    WebSocketMessageType.Text,
                    result.EndOfMessage,
                    CancellationToken.None
                );
                break;
                
            case WebSocketMessageType.Close:
                await webSocket.CloseAsync(
                    WebSocketCloseStatus.NormalClosure,
                    "–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞",
                    CancellationToken.None
                );
                break;
        }
    }
}
```

#### –°–æ—Å—Ç–æ—è–Ω–∏—è WebSocket

```csharp
public enum WebSocketState
{
    None,           // –ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
    Connecting,     // –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    Open,           // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ ‚úÖ
    CloseSent,      // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
    CloseReceived,  // –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
    Closed,         // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ
    Aborted         // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –∞–≤–∞—Ä–∏–π–Ω–æ
}
```

**–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:

```csharp
if (webSocket.State == WebSocketState.Open)
{
    await webSocket.SendAsync(...);
}
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏

–î–ª—è real-time –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```csharp
public class WebSocketManager
{
    private readonly ConcurrentDictionary<string, WebSocket> _sockets = new();
    
    public string AddSocket(WebSocket socket)
    {
        var connectionId = Guid.NewGuid().ToString();
        _sockets.TryAdd(connectionId, socket);
        return connectionId;
    }
    
    public async Task RemoveSocket(string id)
    {
        if (_sockets.TryRemove(id, out var socket))
        {
            await socket.CloseAsync(
                WebSocketCloseStatus.NormalClosure,
                "Connection closed",
                CancellationToken.None
            );
        }
    }
    
    public async Task BroadcastAsync(string message)
    {
        var bytes = Encoding.UTF8.GetBytes(message);
        var tasks = new List<Task>();
        
        foreach (var (id, socket) in _sockets)
        {
            if (socket.State == WebSocketState.Open)
            {
                tasks.Add(socket.SendAsync(
                    new ArraySegment<byte>(bytes),
                    WebSocketMessageType.Text,
                    true,
                    CancellationToken.None
                ));
            }
        }
        
        await Task.WhenAll(tasks);
    }
}
```

### 2.3 SignalR: –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è (10 –º–∏–Ω—É—Ç)

#### –ß—Ç–æ —Ç–∞–∫–æ–µ SignalR

SignalR ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç Microsoft, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ —á–∏—Å—Ç—ã–º WebSocket:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (WebSockets ‚Üí SSE ‚Üí Long Polling)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ Strongly-typed –º–µ—Ç–æ–¥—ã
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (Redis, Azure SignalR Service)
- ‚úÖ RPC-style –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SignalR

```csharp
// Program.cs
var builder = WebApplication.CreateBuilder(args);

// 1. –î–æ–±–∞–≤–ª—è–µ–º SignalR
builder.Services.AddSignalR(options =>
{
    options.EnableDetailedErrors = true;  // –¢–æ–ª—å–∫–æ –¥–ª—è dev!
    options.KeepAliveInterval = TimeSpan.FromSeconds(15);
    options.ClientTimeoutInterval = TimeSpan.FromSeconds(30);
});

var app = builder.Build();

// 2. –ú–∞–ø–ø–∏–º Hub endpoint
app.MapHub<ChatHub>("/chatHub");

app.Run();
```

#### –°–æ–∑–¥–∞–Ω–∏–µ Hub

Hub ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é:

```csharp
using Microsoft.AspNetCore.SignalR;

public class ChatHub : Hub
{
    // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
    public override async Task OnConnectedAsync()
    {
        var connectionId = Context.ConnectionId;
        Console.WriteLine($"–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω: {connectionId}");
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        await Clients.Others.SendAsync("UserConnected", connectionId);
        
        await base.OnConnectedAsync();
    }
    
    // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
    public override async Task OnDisconnectedAsync(Exception exception)
    {
        var connectionId = Context.ConnectionId;
        Console.WriteLine($"–ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–µ–Ω: {connectionId}");
        
        await Clients.Others.SendAsync("UserDisconnected", connectionId);
        
        await base.OnDisconnectedAsync(exception);
    }
    
    // –ú–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—ã
    public async Task SendMessage(string user, string message)
    {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
        await Clients.All.SendAsync("ReceiveMessage", user, message);
    }
}
```

#### HubCallerContext: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ

–ö–∞–∂–¥—ã–π Hub –∏–º–µ–µ—Ç `Context`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:

```csharp
public class ChatHub : Hub
{
    public async Task SendMessage(string message)
    {
        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        var connectionId = Context.ConnectionId;
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–µ—Å–ª–∏ authenticated)
        var userName = Context.User?.Identity?.Name;
        var userId = Context.User?.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        
        // HTTP –∫–æ–Ω—Ç–µ–∫—Å—Ç
        var httpContext = Context.GetHttpContext();
        var ipAddress = httpContext.Connection.RemoteIpAddress;
        
        await Clients.All.SendAsync("ReceiveMessage", userName, message);
    }
}
```

#### Dependency Injection –≤ Hub

Hub –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```csharp
public class ChatHub : Hub
{
    private readonly IChatRepository _chatRepository;
    private readonly ILogger<ChatHub> _logger;
    
    public ChatHub(IChatRepository chatRepository, ILogger<ChatHub> logger)
    {
        _chatRepository = chatRepository;
        _logger = logger;
    }
    
    public async Task SendMessage(string user, string message)
    {
        _logger.LogInformation("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {User}: {Message}", user, message);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
        await _chatRepository.SaveMessageAsync(user, message);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
        await Clients.All.SendAsync("ReceiveMessage", user, message);
    }
}
```

### 2.4 Broadcasting –∏ Groups (7 –º–∏–Ω—É—Ç)

#### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

SignalR –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

```csharp
public class ChatHub : Hub
{
    // 1. –í–°–ï–ú –∫–ª–∏–µ–Ω—Ç–∞–º
    public async Task BroadcastToAll(string message)
    {
        await Clients.All.SendAsync("Receive", message);
    }
    
    // 2. –í–°–ï–ú –ö–†–û–ú–ï –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    public async Task BroadcastToOthers(string message)
    {
        await Clients.Others.SendAsync("Receive", message);
    }
    
    // 3. –¢–û–õ–¨–ö–û –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (—Ç–µ–∫—É—â–µ–º—É –∫–ª–∏–µ–Ω—Ç—É)
    public async Task SendToSelf(string message)
    {
        await Clients.Caller.SendAsync("Receive", message);
    }
    
    // 4. –ö–û–ù–ö–†–ï–¢–ù–û–ú–£ –∫–ª–∏–µ–Ω—Ç—É (–ø–æ connection ID)
    public async Task SendToClient(string connectionId, string message)
    {
        await Clients.Client(connectionId).SendAsync("Receive", message);
    }
    
    // 5. –ù–ï–°–ö–û–õ–¨–ö–ò–ú –∫–ª–∏–µ–Ω—Ç–∞–º
    public async Task SendToClients(List<string> connectionIds, string message)
    {
        await Clients.Clients(connectionIds).SendAsync("Receive", message);
    }
    
    // 6. –ö–û–ù–ö–†–ï–¢–ù–û–ú–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø–æ User ID, –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)
    public async Task SendToUser(string userId, string message)
    {
        await Clients.User(userId).SendAsync("Receive", message);
    }
}
```

#### –†–∞–±–æ—Ç–∞ —Å –≥—Ä—É–ø–ø–∞–º–∏

–ì—Ä—É–ø–ø—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ (–∫–æ–º–Ω–∞—Ç—ã, –∫–∞–Ω–∞–ª—ã):

```csharp
public class ChatRoomHub : Hub
{
    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
    public async Task JoinRoom(string roomName)
    {
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
        await Groups.AddToGroupAsync(Context.ConnectionId, roomName);
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–Ω–∞—Ç—ã
        await Clients.Group(roomName).SendAsync(
            "UserJoinedRoom", 
            Context.ConnectionId, 
            roomName
        );
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞—é—â–µ–º—É
        await Clients.Caller.SendAsync("JoinedRoom", roomName);
    }
    
    // –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
    public async Task LeaveRoom(string roomName)
    {
        await Groups.RemoveFromGroupAsync(Context.ConnectionId, roomName);
        
        await Clients.Group(roomName).SendAsync(
            "UserLeftRoom", 
            Context.ConnectionId, 
            roomName
        );
    }
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–º–Ω–∞—Ç—É
    public async Task SendToRoom(string roomName, string message)
    {
        await Clients.Group(roomName).SendAsync("ReceiveMessage", message);
    }
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç
    public async Task SendToRooms(List<string> roomNames, string message)
    {
        await Clients.Groups(roomNames).SendAsync("ReceiveMessage", message);
    }
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –≤ –∫–æ–º–Ω–∞—Ç–µ –ö–†–û–ú–ï —Å–µ–±—è
    public async Task SendToOthersInRoom(string roomName, string message)
    {
        await Clients.OthersInGroup(roomName).SendAsync("ReceiveMessage", message);
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –≥—Ä—É–ø–ø –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
    public override async Task OnDisconnectedAsync(Exception exception)
    {
        // SignalR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –∏–∑ –≤—Å–µ—Ö –≥—Ä—É–ø–ø
        await base.OnDisconnectedAsync(exception);
    }
}
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: —á–∞—Ç —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏**

```csharp
public class MultiRoomChatHub : Hub
{
    private static readonly Dictionary<string, HashSet<string>> _roomUsers = new();
    
    public async Task JoinRoom(string roomName, string userName)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, roomName);
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ–º–Ω–∞—Ç–µ
        if (!_roomUsers.ContainsKey(roomName))
            _roomUsers[roomName] = new HashSet<string>();
        
        _roomUsers[roomName].Add(Context.ConnectionId);
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –≤ –∫–æ–º–Ω–∞—Ç–µ
        await Clients.Group(roomName).SendAsync(
            "UserJoined", 
            userName, 
            _roomUsers[roomName].Count
        );
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–æ–≤–∏—á–∫—É
        await Clients.Caller.SendAsync("UserList", _roomUsers[roomName]);
    }
    
    public async Task SendMessage(string roomName, string userName, string message)
    {
        await Clients.Group(roomName).SendAsync(
            "ReceiveMessage",
            roomName,
            userName,
            message,
            DateTime.UtcNow
        );
    }
    
    public async Task LeaveRoom(string roomName, string userName)
    {
        await Groups.RemoveFromGroupAsync(Context.ConnectionId, roomName);
        
        _roomUsers[roomName]?.Remove(Context.ConnectionId);
        
        await Clients.Group(roomName).SendAsync(
            "UserLeft", 
            userName, 
            _roomUsers[roomName]?.Count ?? 0
        );
    }
}
```

#### IHubContext: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–≤–Ω–µ Hub

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–µ –∏–∑ Hub (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏–ª–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞):

```csharp
// –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
public class NotificationService
{
    private readonly IHubContext<ChatHub> _hubContext;
    
    public NotificationService(IHubContext<ChatHub> hubContext)
    {
        _hubContext = hubContext;
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º
    public async Task SendSystemNotification(string message)
    {
        await _hubContext.Clients.All.SendAsync("SystemNotification", message);
    }
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    public async Task NotifyUser(string userId, string message)
    {
        await _hubContext.Clients.User(userId).SendAsync("Notification", message);
    }
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–µ
    public async Task NotifyGroup(string groupName, string message)
    {
        await _hubContext.Clients.Group(groupName).SendAsync("Notification", message);
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
[ApiController]
[Route("api/[controller]")]
public class AdminController : ControllerBase
{
    private readonly IHubContext<ChatHub> _hubContext;
    
    public AdminController(IHubContext<ChatHub> hubContext)
    {
        _hubContext = hubContext;
    }
    
    [HttpPost("broadcast")]
    public async Task<IActionResult> BroadcastMessage([FromBody] string message)
    {
        await _hubContext.Clients.All.SendAsync("AdminMessage", message);
        return Ok();
    }
}
```

#### Strongly-Typed Hubs

–î–ª—è type-safety –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Hubs:

```csharp
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤
public interface IChatClient
{
    Task ReceiveMessage(string user, string message);
    Task UserJoined(string user);
    Task UserLeft(string user);
}

// –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç Hub<T>
public class TypedChatHub : Hub<IChatClient>
{
    public async Task SendMessage(string user, string message)
    {
        // –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –∏–º—è –º–µ—Ç–æ–¥–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!
        await Clients.All.ReceiveMessage(user, message);
    }
    
    public override async Task OnConnectedAsync()
    {
        var user = Context.User?.Identity?.Name ?? "Anonymous";
        await Clients.All.UserJoined(user);
        await base.OnConnectedAsync();
    }
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

**–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏:**
1. **IFormFile** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
2. **Streaming** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ñ–∞–π–ª–æ–≤ > 10 MB
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ–∞–π–ª–∞, –Ω–µ —Ç–æ–ª—å–∫–æ MIME-—Ç–∏–ø–∞
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∫—Ä–∏—Ç–∏—á–Ω–∞: –≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞, –∏–∑–æ–ª–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã, –±–ª–æ–∫–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ

**Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è:**
1. **WebSockets** ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏
2. **SignalR** ‚Äî –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
3. **Hubs** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç SignalR –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
4. **Groups** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã
5. **Broadcasting** ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑—É—á–µ–Ω–∏–µ

**–î–ª—è —Ñ–∞–π–ª–æ–≤:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ (Azure Blob Storage, AWS S3)
- Chunked upload —Å resume capability
- Image processing (resizing, thumbnails)
- –ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–ª—è SignalR:**
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Hubs
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis Backplane
- Azure SignalR Service –¥–ª—è serverless
- Streaming –≤ SignalR
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞** –≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ** streaming –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ** –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ** –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤ SignalR
5. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ** –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
6. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ network interruptions
7. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [File uploads in ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/mvc/models/file-uploads)
- [SignalR for ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/signalr/introduction)
- [WebSockets support](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/websockets)

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- [RFC 6455 - The WebSocket Protocol](https://tools.ietf.org/html/rfc6455)
- [RFC 2388 - multipart/form-data](https://tools.ietf.org/html/rfc2388)

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- [OWASP File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html)
- [File Upload Security Best Practices](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)

**–ü—Ä–∏–º–µ—Ä—ã –∏ —Ç—É—Ç–æ—Ä–∏–∞–ª—ã:**
- [SignalR Chat Sample](https://github.com/SignalR/SignalR)
- [Azure SignalR Service Samples](https://github.com/aspnet/AzureSignalR-samples)

---

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ streaming –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤?
2. –ü–æ—á–µ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ MIME-—Ç–∏–ø–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤?
3. –ö–∞–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ?
4. –í —á–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SignalR –ø–µ—Ä–µ–¥ —á–∏—Å—Ç—ã–º WebSocket?
5. –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã?
6. –ö–æ–≥–¥–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IHubContext –≤–º–µ—Å—Ç–æ Hub?
7. –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç Path Traversal –∞—Ç–∞–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤?
```
